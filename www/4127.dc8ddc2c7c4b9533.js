"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4127],{4127:(A,M,a)=>{a.r(M),a.d(M,{MessagesPageModule:()=>B});var u=a(6895),g=a(433),l=a(603),p=a(9062),v=a(5806),_=a(655),f=a(5698),e=a(4650),y=a(9376),P=a(4004),n=a(1228),c=a(5146);let t=(()=>{class s{constructor(o,r){this.auth=o,this.api=r,this.getId()}getId(){console.log(this.currentUserId),this.currentUserId=this.auth.getId()}createChatRoom(o){return(0,_.mG)(this,void 0,void 0,function*(){try{let r;if(console.log("exist docs: ",r),(null==r?void 0:r.length)>0)return r[0];const m={members:[this.currentUserId,o],type:"private",createdAt:new Date,updatedAt:new Date};return r=yield this.api.addDocument("chatRooms",m),r}catch(r){throw r}})}getChatRoomMessages(o){this.selectedChatRoomMessages=this.api.collectionDataQuery(`chats/${o}/messages`,this.api.orderByQuery("createdAt","desc")).pipe((0,P.U)(r=>r.reverse()))}sendMessage(o,r){return(0,_.mG)(this,void 0,void 0,function*(){try{const m={message:r,sender:this.currentUserId,createdAt:new Date};console.log(o),o&&(yield this.api.addDocument(`chats/${o}/messages`,m))}catch(m){throw m}})}}return s.\u0275fac=function(o){return new(o||s)(e.LFG(n.e),e.LFG(c.s))},s.\u0275prov=e.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})();function i(s,d){if(1&s&&(e.TgZ(0,"ion-text")(1,"p"),e._uU(2),e.qZA()()),2&s){const o=e.oxw();e.xp6(2),e.Oqu(o.model.subTitle)}}let h=(()=>{class s{constructor(){}ngOnInit(){}}return s.\u0275fac=function(o){return new(o||s)},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-empty-screen"]],inputs:{model:"model"},decls:9,vars:4,consts:[[1,"ion-text-center"],[3,"name","color"],[4,"ngIf"]],template:function(o,r){1&o&&(e.TgZ(0,"ion-grid")(1,"ion-row")(2,"ion-col",0),e._UZ(3,"ion-icon",1),e.qZA()(),e.TgZ(4,"ion-row")(5,"ion-col",0)(6,"ion-label"),e._uU(7),e.qZA(),e.YNc(8,i,3,1,"ion-text",2),e.qZA()()()),2&o&&(e.xp6(3),e.Q6J("name",null==r.model?null:r.model.icon)("color",null==r.model?null:r.model.color),e.xp6(4),e.hij(" ",null==r.model?null:r.model.title," "),e.xp6(1),e.Q6J("ngIf",null==r.model?null:r.model.subTitle))},dependencies:[u.O5,l.wI,l.jY,l.gu,l.Q$,l.Nd,l.yW],styles:["ion-grid[_ngcontent-%COMP%]{transform:translateY(10vh)}ion-grid[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18rem}"]}),s})();const U=["popover"];function D(s,d){if(1&s){const o=e.EpF();e.TgZ(0,"ion-content",12),e.NdJ("click",function(){e.CHM(o);const m=e.oxw();return e.KtG(m.logout())}),e.TgZ(1,"ion-label",13),e._uU(2," LOGOUT"),e.qZA()()}}function T(s,d){if(1&s&&e._UZ(0,"app-empty-screen",17),2&s){const o=e.oxw(2);e.Q6J("model",o.model)}}function E(s,d){if(1&s&&(e.ynx(0),e.TgZ(1,"ion-avatar",21),e._UZ(2,"img",22),e.qZA(),e.TgZ(3,"ion-label"),e._uU(4),e.qZA(),e.BQk()),2&s){const o=d.ngIf,r=e.oxw(5);let m,C;e.xp6(2),e.Q6J("src",null==(m=r.getUser(o))?null:m.photo,e.LSH),e.xp6(2),e.hij(" ",null==(C=r.getUser(o))?null:C.name," ")}}function I(s,d){if(1&s){const o=e.EpF();e.TgZ(0,"ion-item",20),e.NdJ("click",function(){const C=e.CHM(o).$implicit,w=e.oxw(4);return e.KtG(w.getChat(C))}),e.YNc(1,E,5,2,"ng-container",16),e.ALo(2,"async"),e.qZA()}if(2&s){const o=d.$implicit;e.Q6J("detail",!0),e.xp6(1),e.Q6J("ngIf",e.lcZ(2,2,null==o?null:o.user))}}function O(s,d){if(1&s&&(e.TgZ(0,"ion-list")(1,"ion-list-header",18),e._uU(2," RECENT CHATS "),e.qZA(),e.YNc(3,I,3,4,"ion-item",19),e.qZA()),2&s){const o=e.oxw().ngIf;e.xp6(3),e.Q6J("ngForOf",o)}}function R(s,d){if(1&s&&(e.ynx(0),e.YNc(1,O,4,1,"ion-list",16),e.BQk()),2&s){const o=d.ngIf;e.xp6(1),e.Q6J("ngIf",(null==o?null:o.length)>0)}}function x(s,d){if(1&s&&(e.TgZ(0,"ion-content",14),e.YNc(1,T,1,1,"app-empty-screen",15),e.ALo(2,"async"),e.YNc(3,R,2,1,"ng-container",16),e.ALo(4,"async"),e.qZA()),2&s){const o=e.oxw();let r;e.xp6(1),e.Q6J("ngIf",0===(null==(r=e.lcZ(2,2,o.chatRooms))?null:r.length)),e.xp6(2),e.Q6J("ngIf","chats"===o.segment&&e.lcZ(4,4,o.chatRooms))}}const L=[{path:"",canActivate:[v.a],component:(()=>{class s{constructor(o,r,m){this.routerService=o,this.chatService=r,this.modalCtrl=m,this.isCollapsed=!0,this.segment="chats",this.open_new_chat=!1,this.model={icon:"chatbubbles-outline",title:"No Chat Rooms",color:"danger"},this.isLogin=!1}ngOnInit(){this.getRooms(),this.isLogin=this.chatService.auth.isLogin}openLoginModal(){return this.routerService.navigate("/login")}getRooms(){this.chatRooms=this.chatService.chatRooms,console.log("chatrooms: ",this.chatRooms)}logout(){return(0,_.mG)(this,void 0,void 0,function*(){try{console.log("logout"),this.popover.dismiss(),yield this.chatService.auth.logout().then(o=>{this.routerService.navigate("/login")})}catch(o){console.log(o)}})}onSegmentChanged(o){console.log(o),this.segment=o.detail.value}newChat(){this.open_new_chat=!0,this.users||this.getUsers()}getUsers(){this.users=this.chatService.users}onWillDismiss(o){}getChat(o){(null==o?void 0:o.user).pipe((0,f.q)(1)).subscribe(r=>{console.log("data: ",r),this.routerService.navigateWithData(["/","home","chats",null==o?void 0:o.id],{queryParams:{name:null==r?void 0:r.name}})})}getUser(o){return o}}return s.\u0275fac=function(o){return new(o||s)(e.Y36(y.c),e.Y36(t),e.Y36(l.IN))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-messages"]],viewQuery:function(o,r){if(1&o&&e.Gf(U,5),2&o){let m;e.iGM(m=e.CRH())&&(r.popover=m.first)}},decls:21,vars:2,consts:[[1,"title-header"],["color","primary"],["name","mail-outline","slot","start","size","large",1,"ion-padding"],["slot","end"],["fill","clear","id","popover"],["slot","icon-only","name","ellipsis-vertical-outline"],["trigger","popover","triggerAction","click"],["popover",""],["mode","md",3,"value","ionChange"],["value","chats"],["value","contacts"],["color","light",4,"ngIf"],[1,"ion-padding","ion-text-center",3,"click"],["color","danger"],["color","light"],[3,"model",4,"ngIf"],[4,"ngIf"],[3,"model"],["color","light",1,"ion-padding-bottom"],[3,"detail","click",4,"ngFor","ngForOf"],[3,"detail","click"],["slot","start"],[3,"src"]],template:function(o,r){1&o&&(e.TgZ(0,"ion-content")(1,"ion-header",0)(2,"ion-toolbar",1),e._UZ(3,"ion-icon",2),e.TgZ(4,"ion-title"),e._uU(5,"My Messages"),e.qZA(),e.TgZ(6,"ion-buttons",3)(7,"ion-button",4),e._UZ(8,"ion-icon",5),e.qZA()(),e.TgZ(9,"ion-popover",6,7),e.YNc(11,D,3,0,"ng-template"),e.qZA(),e._uU(12," > "),e.qZA(),e.TgZ(13,"ion-segment",8),e.NdJ("ionChange",function(C){return r.onSegmentChanged(C)}),e.TgZ(14,"ion-segment-button",9)(15,"ion-label"),e._uU(16,"Chats"),e.qZA()(),e.TgZ(17,"ion-segment-button",10)(18,"ion-label"),e._uU(19,"Contacts"),e.qZA()()()(),e.YNc(20,x,5,6,"ion-content",11),e.qZA()),2&o&&(e.xp6(13),e.Q6J("value",r.segment),e.xp6(7),e.Q6J("ngIf",!0===r.isLogin))},dependencies:[u.sg,u.O5,l.BJ,l.YG,l.Sm,l.W2,l.Gu,l.gu,l.Ie,l.Q$,l.q_,l.yh,l.cJ,l.GO,l.wd,l.sr,l.d8,l.QI,h,u.Ov],styles:[".content-grid[_ngcontent-%COMP%]{width:-webkit-max-content;width:-moz-max-content;width:max-content;display:flex;justify-content:center;align-items:center}.container[_ngcontent-%COMP%]{height:500px;width:100%}.in-item[_ngcontent-%COMP%]{width:-webkit-max-content;width:-moz-max-content;width:max-content;height:-webkit-max-content;height:-moz-max-content;height:max-content}ion-row[_ngcontent-%COMP%]{height:-webkit-fit-content;height:-moz-fit-content;height:fit-content;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content}"]}),s})()},{path:"message",loadChildren:()=>a.e(6948).then(a.bind(a,6948)).then(s=>s.MessagePageModule)}];let Z=(()=>{class s{}return s.\u0275fac=function(o){return new(o||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[p.Bz.forChild(L),p.Bz]}),s})();var F=a(4197);let B=(()=>{class s{}return s.\u0275fac=function(o){return new(o||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[u.ez,g.u5,l.Pc,Z,F.lQ]}),s})()},5146:(A,M,a)=>{a.d(M,{s:()=>e});var u=a(3562),g=a(8179),l=a(4004),p=a(590),v=a(4650),_=a(1085),f=a(5552);let e=(()=>{class y{constructor(n,c,t){this.firestore=n,this.db=c,this.fireDatabase=t,this.feedsCollection=this.db.collection("feeds"),this.usersCollection=this.db.collection("users")}filterFeedData(n){return this.db.collection("feeds",c=>c.where("userType","==",n.charAt(0).toUpperCase()).orderBy("time","desc")).snapshotChanges().pipe((0,l.U)(c=>c.map(t=>(console.log(t),Object.assign({id:t.payload.doc.id},t.payload.doc.data())))))}getDocById(n){const c=this.docRef(n);return(0,g.QT)(c)}getDocsByField(n,c,t){return this.db.collection(n,i=>i.where(c,"==",t))}getUserByEmail(n){return console.log("Provided email",n),this.getDocsByField("users","email",n).snapshotChanges().pipe((0,l.U)(c=>{const t=c[0],i=t.payload.doc.data();return{id:t.payload.doc.id,name:i.name,lastName:i.lastName,username:i.username,email:i.email,userType:i.userType,password:i.password,location:i.location,profilePictureUrl:i.profilePictureUrl,pershkrim:i.pershkrim}}),(0,p.P)())}docRef(n){return(0,u.JU)(this.firestore,n)}collectionRef(n){return(0,g.hJ)(this.firestore,n)}setDocument(n,c){const t=this.docRef(n);return(0,u.pl)(t,c)}addDocument(n,c){const t=this.collectionRef(n);return(0,g.ET)(t,c)}getDocs(n,c){let t=this.collectionRef(n);return c&&(t=(0,g.IO)(t,c)),(0,g.PL)(t)}collectionDataQuery(n,c){let t=this.collectionRef(n);return c&&(t=(0,g.IO)(t,c)),(0,u.BS)(t,{idField:"id"})}docDataQuery(n,c,t){let h,i=this.docRef(n);return t&&(i=(0,g.IO)(i,t)),h=c?(0,u._1)(i,{idField:"id"}):(0,u._1)(i),h}orderByQuery(n,c="asc"){return(0,g.Xo)(n,c)}addFeed(n){return this.feedsCollection.doc(n.id).set(n).then(()=>{console.log("Feed updated successfully!")}).catch(c=>{console.error(c)})}updateFeedFieldById(n,c){return this.feedsCollection.doc(n).update(c).then(()=>{console.log("Feed updated successfully!")}).catch(t=>{console.error(t)})}deleteFeed(n){return this.feedsCollection.doc(n).delete().then(()=>{console.log("Feed deleted successfully!")}).catch(c=>{console.error(c)})}getFeed(n){return this.feedsCollection.doc(n).get()}updateUser(n,c){return this.usersCollection.doc(n).update(c).then(()=>{console.log("User updated successfully!")}).catch(t=>{console.error(t)})}deleteUserData(n){return this.usersCollection.doc(n).delete().then(()=>{console.log("User deleted successfully!")}).catch(c=>{console.error(c)})}getUser(n){return this.usersCollection.doc(n).get()}deleteUserFeeds(n){return this.filterFeedData(n.userType).subscribe(c=>{c.forEach(t=>{t.userName==n.username&&this.deleteFeed(t.id).then(i=>{}).catch(i=>{throw i})})})}}return y.\u0275fac=function(n){return new(n||y)(v.LFG(u.gg),v.LFG(_.ST),v.LFG(f.KQ))},y.\u0275prov=v.Yz7({token:y,factory:y.\u0275fac,providedIn:"root"}),y})()},1228:(A,M,a)=>{a.d(M,{e:()=>P});var u=a(655),g=a(4322),l=a(1135),p=a(4650),v=a(9376),_=a(7323),f=a(1205),e=a(5146),y=a(603);let P=(()=>{class n{constructor(t,i,h,U,D){this.routerService=t,this.auth=i,this.afAuth=h,this.apiService=U,this.alertController=D,this._uid=new l.X(null),this.userType="U",this.currentUserId="",1==this.isLogin&&this.getCurrentUser().subscribe(T=>{this.userType=T.data().userType.charAt(0).toUpperCase(),console.log(this.userType,"=usertype")}),this.checkAuth().then(T=>{this.isLogin=!0,this.getCurrentUser().subscribe(E=>{this.userType=E.data().userType.charAt(0).toUpperCase(),console.log(this.userType,"=usertype")})}).catch(T=>{this.isLogin=!1})}getCurrentUser(){return this.getUserId(),console.log(this.currentUserId,"id on authService",this.auth.currentUser.uid),this.apiService.getUser(this.auth.currentUser.uid)}getUserId(){return this.afAuth.authState.subscribe(t=>{t&&(console.log(t.uid),this.currentUserId=t.uid)}),this.currentUserId}login(t,i){return(0,u.mG)(this,void 0,void 0,function*(){try{const h=(0,g.e5)(this.auth,t,i);console.log(h),(yield h).user&&(this.setUserData((yield h).user.uid),this.isLogin=!0,this.correctUser=yield this.getUserData(this._uid),this.getCurrentUser().subscribe(U=>{this.userType=U.data().userType.charAt(0).toUpperCase(),console.log(this.userType,"=usertype"),sessionStorage.setItem("userName",U.data().username),sessionStorage.setItem("userType",this.userType),this.currentUserId=U.data().id}))}catch(h){throw this.isLogin=!1,h}})}getId(){var t;const i=(0,g.v0)();return this.correctUser=i.currentUser,console.log(this.correctUser),null===(t=this.correctUser)||void 0===t?void 0:t.uid}setUserData(t){this._uid.next(t)}randomIntFromInterval(t,i){return Math.floor(Math.random()*(i-t+1)+t)}register(t){return(0,u.mG)(this,void 0,void 0,function*(){try{const i=yield(0,g.Xb)(this.auth,t.email,t.password);console.log("perdoruesi i regjistruar : ",i);const h={id:i.user.uid,name:t.name.charAt(0).toUpperCase()+t.name.slice(1),lastName:t.lastName.charAt(0).toUpperCase()+t.lastName.slice(1),username:t.username.charAt(0).toUpperCase()+t.username.slice(1),email:t.email,userType:t.userType.charAt(0).toUpperCase()+t.userType.slice(1),profilePictureUrl:"https://i.avatar/"+this.randomIntFromInterval(200,400)};yield this.apiService.setDocument("users/".concat(i.user.uid),h)}catch(i){throw i}})}resetUserPassword(t){return(0,u.mG)(this,void 0,void 0,function*(){try{yield(0,g.LS)(this.auth,t).catch(i=>{throw i})}catch(i){throw i}})}logout(){return(0,u.mG)(this,void 0,void 0,function*(){return yield this.auth.signOut().then(t=>{this.isLogin=!1,this.userType="U",this._uid.next(null)}).catch(t=>{throw t}),!0})}checkAuth(){return new Promise((t,i)=>{(0,g.Aj)(this.auth,h=>{t(h)})})}getUserData(t){return(0,u.mG)(this,void 0,void 0,function*(){yield(yield this.apiService.getDocById("users/$(id)")).data()})}deleteAccount(t){return this.auth.currentUser.delete().then(i=>{console.log(t,"Deleted"),this.deleteUserData(t),this.logout().then(h=>{this.routerService.navigate("/login").then(U=>{})})}).catch(i=>{this.showAlert(i.code).then(h=>{})})}showAlert(t){return(0,u.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({header:"Alert?",cssClass:"custom-alert",message:t,buttons:["OK"]})).present()})}deleteUserData(t){this.apiService.deleteUserData(t.id).then(i=>{this.isLogin=!1,this.userType="U",this._uid.next(null),this.correctUser=null,this.apiService.deleteUserFeeds(t)})}changePass(t){return this.afAuth.currentUser.then(i=>{i.updatePassword(t).then(()=>{console.log("Password changed successfully")}).catch(h=>{console.error("Error changing password:",h)})})}}return n.\u0275fac=function(t){return new(t||n)(p.LFG(v.c),p.LFG(_.gx),p.LFG(f.zQ),p.LFG(e.s),p.LFG(y.Br))},n.\u0275prov=p.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})()},9376:(A,M,a)=>{a.d(M,{c:()=>l});var u=a(9062),g=a(4650);let l=(()=>{class p{constructor(_){this.router=_}navigate(_){return this.router.events.subscribe(f=>{f instanceof u.wM&&"administration"===f.snapshot.outlet&&this.outlet.deactivate()}),this.router.navigateByUrl(_,{replaceUrl:!0}).then(f=>{}).catch(f=>{})}navigateWithData(_,f){return this.router.events.subscribe(e=>{e instanceof u.wM&&"administration"===e.snapshot.outlet&&this.outlet.deactivate()}),this.router.navigate(_,f).then(e=>{}).catch(e=>{})}}return p.\u0275fac=function(_){return new(_||p)(g.LFG(u.F0))},p.\u0275prov=g.Yz7({token:p,factory:p.\u0275fac,providedIn:"root"}),p})()}}]);