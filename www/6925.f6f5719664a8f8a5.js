"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6925],{6925:(M,C,l)=>{l.r(C),l.d(C,{LoginPageModule:()=>f});var h=l(6895),u=l(433),i=l(603),_=l(9062),d=l(5861),t=l(4650),v=l(1228),y=l(9376);class P{constructor(r,c){this.authService=r,this.routerService=c}canActivate(){var r=this;return(0,d.Z)(function*(){try{const c=yield r.authService.checkAuth();return console.log(c),!c||(yield r.routerService.navigate("./tabs/landing-page"),!1)}catch(c){return console.log(c),yield r.routerService.navigate("./tabs/landing-page"),!1}})()}}P.\u0275fac=function(r){return new(r||P)(t.LFG(v.e),t.LFG(y.c))},P.\u0275prov=t.Yz7({token:P,factory:P.\u0275fac,providedIn:"root"});class o{}class s{constructor(r,c,m){this.modalCtrl=r,this.authService=c,this.alertController=m,this.email=""}ngOnInit(){}closeModal(){var r=this;return(0,d.Z)(function*(){yield r.modalCtrl.dismiss()})()}resetPass(){try{0!==this.email.length&&this.authService.resetUserPassword(this.email)}catch(r){this.showAlert(r.code)}}showAlert(r){var c=this;return(0,d.Z)(function*(){yield(yield c.alertController.create({header:"Alert?",cssClass:"custom-alert",message:r,buttons:["OK"]})).present()})()}}s.\u0275fac=function(r){return new(r||s)(t.Y36(i.IN),t.Y36(v.e),t.Y36(i.Br))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-forgot-password"]],decls:18,vars:1,consts:[[1,"main-view"],["color","primary"],["slot","end"],[3,"click"],["name","close"],[1,"modal-content"],["position","floating"],["type","text",3,"ngModel","ngModelChange"],["expand","full",3,"click"],[2,"height","20px"]],template:function(r,c){1&r&&(t.TgZ(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-title"),t._uU(3," Forgot Password "),t.qZA(),t.TgZ(4,"ion-buttons",2)(5,"ion-button",3),t.NdJ("click",function(){return c.closeModal()}),t._UZ(6,"ion-icon",4),t.qZA()()()(),t.TgZ(7,"ion-content",5)(8,"ion-list")(9,"ion-item")(10,"ion-label",6),t._uU(11,"Enter your Email"),t.qZA(),t.TgZ(12,"ion-input",7),t.NdJ("ngModelChange",function(U){return c.email=U}),t.qZA()()(),t.TgZ(13,"ion-button",8),t.NdJ("click",function(){return c.resetPass()}),t._uU(14,"Submit"),t.qZA(),t._UZ(15,"div",9)(16,"br")(17,"br"),t.qZA()),2&r&&(t.xp6(12),t.Q6J("ngModel",c.email))},dependencies:[u.JJ,u.On,i.YG,i.Sm,i.W2,i.Gu,i.gu,i.pK,i.Ie,i.Q$,i.q_,i.wd,i.sr,i.j9]});var e=l(5146);class n{constructor(r,c,m,U,b,T){this.modalCtrl=r,this.rute=c,this.authService=m,this.routerService=U,this.alertController=b,this.apiService=T,this.email="",this.password="",this.isTypePassword=!0,this.isLogin=!1,this.selectedUser=new o}ngOnInit(){}login(){this.authService.login(this.email,this.password).then(r=>{this.isLogin=!0,console.log("is login :",this.isLogin),this.routerService.navigate("/tabs")}).catch(r=>{console.log(r),this.isLogin=!1;let c="Could not sign you in, please try again.";"auth/user-not-found"==r.code?c="E-mail address could not be found":"auth/wrong-password"==r.code&&(c="Please enter a correct password"),this.showAlert(c)})}forgotPass(){console.log("this.forgotPass"),this.openPassModal().then(r=>{})}signUp(){var r=this;return(0,d.Z)(function*(){yield r.modalCtrl.dismiss(),r.openRegisterModal()})()}closeModal(){var r=this;return(0,d.Z)(function*(){r.rute.navigateRoot(["tabs/landing-page"]),yield r.modalCtrl.dismiss()})()}openRegisterModal(){this.routerService.navigate("/login/register")}openPassModal(){var r=this;return(0,d.Z)(function*(){return yield(yield r.modalCtrl.create({component:s,cssClass:"modal-large"})).present()})()}showAlert(r){var c=this;return(0,d.Z)(function*(){yield(yield c.alertController.create({header:"Alert?",cssClass:"custom-alert",message:r,buttons:["OK"]})).present()})()}}n.\u0275fac=function(r){return new(r||n)(t.Y36(i.IN),t.Y36(i.SH),t.Y36(v.e),t.Y36(y.c),t.Y36(i.Br),t.Y36(e.s))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-login"]],decls:33,vars:2,consts:[[1,"ion-text-center","toolbar"],["slot","end"],["routerLink","/tabs/landing-page","color","black"],["name","close"],[1,"content"],[1,"modal-content"],["position","floating"],["type","text",3,"ngModel","ngModelChange"],["type","password",3,"ngModel","keyup.enter","ngModelChange"],[1,"login-button","ion-text-center"],["type","submit","enter","",1,"signinButton",3,"keyup.enter","click"],[2,"height","20"],[1,"ion-align-items-center"],["color","danger","size","small","fill","clear",2,"text-align","center !important",3,"click"],[1,"login-q"],["color","success","routerLink","register","size","small"]],template:function(r,c){1&r&&(t.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),t._uU(3," Login"),t.qZA(),t.TgZ(4,"ion-buttons",1)(5,"ion-button",2),t._UZ(6,"ion-icon",3),t.qZA()()()(),t.TgZ(7,"div",4)(8,"ion-content",5)(9,"ion-list")(10,"ion-item")(11,"ion-label",6),t._uU(12,"Email"),t.qZA(),t.TgZ(13,"ion-input",7),t.NdJ("ngModelChange",function(U){return c.email=U}),t.qZA()(),t.TgZ(14,"ion-item")(15,"ion-label",6),t._uU(16,"Password"),t.qZA(),t.TgZ(17,"ion-input",8),t.NdJ("keyup.enter",function(){return c.login()})("ngModelChange",function(U){return c.password=U}),t.qZA()()(),t.TgZ(18,"div",9)(19,"ion-button",10),t.NdJ("keyup.enter",function(){return c.login()})("click",function(){return c.login()}),t._uU(20,"Log in "),t.qZA()(),t._UZ(21,"div",11)(22,"br")(23,"br"),t.TgZ(24,"ion-item",12)(25,"ion-button",13),t.NdJ("click",function(){return c.forgotPass()}),t._uU(26," Forgot password "),t.qZA()(),t._UZ(27,"br"),t.TgZ(28,"ion-row")(29,"ion-label",14),t._uU(30,"Don't have an account?"),t.qZA(),t.TgZ(31,"ion-button",15),t._uU(32," Register "),t.qZA()()()()),2&r&&(t.xp6(13),t.Q6J("ngModel",c.email),t.xp6(4),t.Q6J("ngModel",c.password))},dependencies:[u.JJ,u.On,i.YG,i.Sm,i.W2,i.Gu,i.gu,i.pK,i.Ie,i.Q$,i.q_,i.Nd,i.wd,i.sr,i.j9,i.YI,_.rH],styles:[".login-q[_ngcontent-%COMP%]{margin:10px}modal-wrapper[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%}@media not all and (min-height: 600px) and (min-width: 768px){ion-modal[_ngcontent-%COMP%]   ion-backdrop[_ngcontent-%COMP%]{visibility:hidden}}@media only screen and (min-height: 0px) and (min-width: 0px){.modal-wrapper[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%}}.overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;z-index:1;opacity:.5;background-color:#333}.modal_content[_ngcontent-%COMP%]{display:block;position:relative;top:25%;left:0;right:0;width:100%;height:50%;z-index:1;margin:0 auto;padding:10px;color:#333;background:#e8e8e8;background:linear-gradient(to bottom,#fff 0%,#e8e8e8 100%);border-radius:5px;box-shadow:0 2px 3px rgba(51,51,51,.35);box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box}.circle[_ngcontent-%COMP%]{position:absolute;height:100px;width:100px;border-radius:50%;border:3px solid white;left:50%;margin-left:-55px;top:-40px;background:#d33;z-index:10000}.modal-content[_ngcontent-%COMP%]{padding-top:5rem}.content[_ngcontent-%COMP%]{width:400px;height:800px;margin:auto}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{background:cadetblue}ion-header[_ngcontent-%COMP%]   ion-buttons[_ngcontent-%COMP%]{background:transparent}ion-header[_ngcontent-%COMP%]   ion-buttons[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{background:transparent}ion-header[_ngcontent-%COMP%]   ion-buttons[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{background:transparent}ion-header[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{background-color:gray}"]});const a=[{path:"",canActivate:[P],component:n},{path:"register",loadChildren:()=>l.e(6071).then(l.bind(l,6071)).then(p=>p.RegisterPageModule)}];class g{}g.\u0275fac=function(r){return new(r||g)},g.\u0275mod=t.oAB({type:g}),g.\u0275inj=t.cJS({imports:[_.Bz.forChild(a),_.Bz]});class f{}f.\u0275fac=function(r){return new(r||f)},f.\u0275mod=t.oAB({type:f}),f.\u0275inj=t.cJS({imports:[h.ez,u.u5,i.Pc,g]})},5146:(M,C,l)=>{l.d(C,{s:()=>y});var h=l(3562),u=l(8179),i=l(4004),_=l(590),d=l(4650),t=l(1085),v=l(5552);class y{constructor(o,s,e){this.firestore=o,this.db=s,this.fireDatabase=e,this.feedsCollection=this.db.collection("feeds"),this.usersCollection=this.db.collection("users")}filterFeedData(o){return this.db.collection("feeds",s=>s.where("userType","==",o.charAt(0).toUpperCase()).orderBy("time","desc")).snapshotChanges().pipe((0,i.U)(s=>s.map(e=>(console.log(e),{id:e.payload.doc.id,...e.payload.doc.data()}))))}getDocById(o){const s=this.docRef(o);return(0,u.QT)(s)}getDocsByField(o,s,e){return this.db.collection(o,n=>n.where(s,"==",e))}filterUserByField(o,s){return this.db.collection("users",n=>n.where(o,"==",s)).valueChanges()}getUserByEmail(o){return console.log("Provided email",o),this.getDocsByField("users","email",o).snapshotChanges().pipe((0,i.U)(s=>{const e=s[0],n=e.payload.doc.data();return{id:e.payload.doc.id,name:n.name,lastName:n.lastName,username:n.username,email:n.email,userType:n.userType,password:n.password,location:n.location,profilePictureUrl:n.profilePictureUrl,pershkrim:n.pershkrim}}),(0,_.P)())}docRef(o){return(0,h.JU)(this.firestore,o)}collectionRef(o){return(0,u.hJ)(this.firestore,o)}setDocument(o,s){const e=this.docRef(o);return(0,h.pl)(e,s)}addDocument(o,s){const e=this.collectionRef(o);return(0,u.ET)(e,s)}getDocs(o,s){let e=this.collectionRef(o);return s&&(e=(0,u.IO)(e,s)),(0,u.PL)(e)}collectionDataQuery(o,s){let e=this.collectionRef(o);return s&&(e=(0,u.IO)(e,s)),(0,h.BS)(e,{idField:"id"})}docDataQuery(o,s,e){let a,n=this.docRef(o);return e&&(n=(0,u.IO)(n,e)),a=s?(0,h._1)(n,{idField:"id"}):(0,h._1)(n),a}orderByQuery(o,s="asc"){return(0,u.Xo)(o,s)}addFeed(o){u.EK.now();const e={id:o.id,kompania:o.kompania,pershkrim:o.pershkrim,tel:o.tel,time:o.time,tittle:o.tittle,userName:o.userName,userType:o.userType,vendodhja:o.vendodhja,whatsApp:o.whatsApp};return console.log(o,"add Feed method"),this.feedsCollection.doc(o.id).set(e).then(()=>{console.log("Feed updated successfully!")}).catch(n=>{console.error(n)})}updateFeedFieldById(o,s){return this.feedsCollection.doc(o).update(s).then(()=>{console.log("Feed updated successfully!")}).catch(e=>{console.error(e)})}deleteFeed(o){return this.feedsCollection.doc(o).delete().then(()=>{console.log("Feed deleted successfully!")}).catch(s=>{console.error(s)})}getFeed(o){return this.feedsCollection.doc(o).get()}updateUser(o,s){return this.usersCollection.doc(o).update(s).then(()=>{console.log("User updated successfully!")}).catch(e=>{console.error(e)})}deleteUserData(o){return this.usersCollection.doc(o).delete().then(()=>{console.log("User deleted successfully!")}).catch(s=>{console.error(s)})}getUser(o){return this.usersCollection.doc(o).get()}deleteUserFeeds(o){return this.filterFeedData(o.userType).subscribe(s=>{s.forEach(e=>{e.userName==o.username&&this.deleteFeed(e.id).then(n=>{}).catch(n=>{throw n})})})}}y.\u0275fac=function(o){return new(o||y)(d.LFG(h.gg),d.LFG(t.ST),d.LFG(v.KQ))},y.\u0275prov=d.Yz7({token:y,factory:y.\u0275fac,providedIn:"root"})},1228:(M,C,l)=>{l.d(C,{e:()=>o});var h=l(5861),u=l(4322),i=l(1135),_=l(4650),d=l(9376),t=l(7323),v=l(1205),y=l(5146),P=l(603);class o{constructor(e,n,a,g,f){this.routerService=e,this.auth=n,this.afAuth=a,this.apiService=g,this.alertController=f,this._uid=new i.X(null),this.userType="U",this.currentUserId="",this.isLogin=!1,1==this.isLogin&&this.getCurrentUser().subscribe(p=>{this.userType=p.data().userType.charAt(0).toUpperCase(),console.log(this.userType,"=usertype")}),this.checkAuth().then(p=>{this.isLogin=!0,this.getCurrentUser().subscribe(r=>{this.userType=r.data().userType.charAt(0).toUpperCase(),console.log(this.userType,"=usertype")})}).catch(p=>{this.isLogin=!1})}getCurrentUser(){if(this.getUserId(),this.auth.currentUser.uid.length>0)return console.log(this.currentUserId,"id on authService",this.auth.currentUser.uid),this.apiService.getUser(this.auth.currentUser.uid)}getUserId(){return this.afAuth.authState.subscribe(e=>{e&&(console.log(e.uid,"aush"),this.currentUserId=e.uid)}),setTimeout(()=>{},2500),this.currentUserId}getAuthState(){return this.afAuth}login(e,n){var a=this;return(0,h.Z)(function*(){try{const g=(0,u.e5)(a.auth,e,n);console.log(g),(yield g).user&&(a.setUserData((yield g).user.uid),a.isLogin=!0,a.correctUser=yield a.getUserData(a._uid),a.getCurrentUser().subscribe(f=>{a.userType=f.data().userType.charAt(0).toUpperCase(),console.log(a.userType,"=usertype"),sessionStorage.setItem("userName",f.data().username),sessionStorage.setItem("userType",a.userType),a.currentUserId=f.data().id}))}catch(g){throw a.isLogin=!1,g}})()}getId(){var e;const n=(0,u.v0)();return this.correctUser=n.currentUser,console.log(this.correctUser),null===(e=this.correctUser)||void 0===e?void 0:e.uid}setUserData(e){this._uid.next(e)}randomIntFromInterval(e,n){return Math.floor(Math.random()*(n-e+1)+e)}register(e){var n=this;return(0,h.Z)(function*(){try{const a=yield(0,u.Xb)(n.auth,e.email,e.password);console.log("perdoruesi i regjistruar : ",a);const g={id:a.user.uid,name:e.name.charAt(0).toUpperCase()+e.name.slice(1),lastName:e.lastName.charAt(0).toUpperCase()+e.lastName.slice(1),username:e.username.charAt(0).toUpperCase()+e.username.slice(1),email:e.email,userType:e.userType.charAt(0).toUpperCase()+e.userType.slice(1),profilePictureUrl:"https://i.avatar/"+n.randomIntFromInterval(200,400)};yield n.apiService.setDocument("users/".concat(a.user.uid),g)}catch(a){throw a}})()}resetUserPassword(e){var n=this;return(0,h.Z)(function*(){try{yield(0,u.LS)(n.auth,e).catch(a=>{throw a})}catch(a){throw a}})()}logout(){var e=this;return(0,h.Z)(function*(){return yield e.auth.signOut().then(n=>{e.isLogin=!1,e.userType="U",e._uid.next(null)}).catch(n=>{throw n}),!0})()}checkAuth(){return new Promise((e,n)=>{(0,u.Aj)(this.auth,a=>{e(a)})})}getUserData(e){var n=this;return(0,h.Z)(function*(){yield(yield n.apiService.getDocById("users/$(id)")).data()})()}deleteAccount(e){return this.auth.currentUser.delete().then(n=>{console.log(e,"Deleted"),this.deleteUserData(e),this.logout().then(a=>{this.routerService.navigate("/login").then(g=>{})})}).catch(n=>{this.showAlert(n.code).then(a=>{})})}showAlert(e){var n=this;return(0,h.Z)(function*(){yield(yield n.alertController.create({header:"Alert?",cssClass:"custom-alert",message:e,buttons:["OK"]})).present()})()}deleteUserData(e){this.apiService.deleteUserData(e.id).then(n=>{this.isLogin=!1,this.userType="U",this._uid.next(null),this.correctUser=null,this.apiService.deleteUserFeeds(e)})}changePass(e){return this.afAuth.currentUser.then(n=>{n.updatePassword(e).then(()=>{console.log("Password changed successfully")}).catch(a=>{console.error("Error changing password:",a)})})}}o.\u0275fac=function(e){return new(e||o)(_.LFG(d.c),_.LFG(t.gx),_.LFG(v.zQ),_.LFG(y.s),_.LFG(P.Br))},o.\u0275prov=_.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"})},9376:(M,C,l)=>{l.d(C,{c:()=>i});var h=l(9062),u=l(4650);class i{constructor(d){this.router=d}navigate(d){return this.router.events.subscribe(t=>{t instanceof h.wM&&"administration"===t.snapshot.outlet&&this.outlet.deactivate()}),this.router.navigateByUrl(d,{replaceUrl:!0}).then(t=>{}).catch(t=>{})}navigateWithData(d,t){return this.router.events.subscribe(v=>{v instanceof h.wM&&"administration"===v.snapshot.outlet&&this.outlet.deactivate()}),this.router.navigate(d,t).then(v=>{}).catch(v=>{})}}i.\u0275fac=function(d){return new(d||i)(u.LFG(h.F0))},i.\u0275prov=u.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"})}}]);