"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6925],{6925:(b,C,a)=>{a.r(C),a.d(C,{LoginPageModule:()=>P});var h=a(6895),d=a(433),s=a(603),g=a(9062),p=a(655),e=a(4650),f=a(1228),v=a(9376);let y=(()=>{class l{constructor(i,c){this.authService=i,this.routerService=c}canActivate(){return(0,p.mG)(this,void 0,void 0,function*(){try{const i=yield this.authService.checkAuth();return console.log(i),!i||(yield this.routerService.navigate("./tabs/home"),!1)}catch(i){return console.log(i),yield this.routerService.navigate("./tabs/home"),!1}})}}return l.\u0275fac=function(i){return new(i||l)(e.LFG(f.e),e.LFG(v.c))},l.\u0275prov=e.Yz7({token:l,factory:l.\u0275fac,providedIn:"root"}),l})();class M{}let o=(()=>{class l{constructor(i,c,_){this.modalCtrl=i,this.authService=c,this.alertController=_,this.email=""}ngOnInit(){}closeModal(){return(0,p.mG)(this,void 0,void 0,function*(){yield this.modalCtrl.dismiss()})}resetPass(){try{0!==this.email.length&&this.authService.resetUserPassword(this.email)}catch(i){this.showAlert(i.code)}}showAlert(i){return(0,p.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({header:"Alert?",cssClass:"custom-alert",message:i,buttons:["OK"]})).present()})}}return l.\u0275fac=function(i){return new(i||l)(e.Y36(s.IN),e.Y36(f.e),e.Y36(s.Br))},l.\u0275cmp=e.Xpm({type:l,selectors:[["app-forgot-password"]],decls:18,vars:1,consts:[[1,"main-view"],["color","primary"],["slot","end"],[3,"click"],["name","close"],[1,"modal-content"],["position","floating"],["type","text",3,"ngModel","ngModelChange"],["expand","full",3,"click"],[2,"height","20px"]],template:function(i,c){1&i&&(e.TgZ(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-title"),e._uU(3," Forgot Password "),e.qZA(),e.TgZ(4,"ion-buttons",2)(5,"ion-button",3),e.NdJ("click",function(){return c.closeModal()}),e._UZ(6,"ion-icon",4),e.qZA()()()(),e.TgZ(7,"ion-content",5)(8,"ion-list")(9,"ion-item")(10,"ion-label",6),e._uU(11,"Enter your Email"),e.qZA(),e.TgZ(12,"ion-input",7),e.NdJ("ngModelChange",function(U){return c.email=U}),e.qZA()()(),e.TgZ(13,"ion-button",8),e.NdJ("click",function(){return c.resetPass()}),e._uU(14,"Submit"),e.qZA(),e._UZ(15,"div",9)(16,"br")(17,"br"),e.qZA()),2&i&&(e.xp6(12),e.Q6J("ngModel",c.email))},dependencies:[d.JJ,d.On,s.YG,s.Sm,s.W2,s.Gu,s.gu,s.pK,s.Ie,s.Q$,s.q_,s.wd,s.sr,s.j9]}),l})();var r=a(5146);const n=[{path:"",canActivate:[y],component:(()=>{class l{constructor(i,c,_,U,O,A){this.modalCtrl=i,this.rute=c,this.authService=_,this.routerService=U,this.alertController=O,this.apiService=A,this.email="",this.password="",this.isTypePassword=!0,this.isLogin=!1,this.selectedUser=new M}ngOnInit(){}login(){this.authService.login(this.email,this.password).then(i=>{this.isLogin=!0,console.log("is login :",this.isLogin),this.routerService.navigate("/tabs")}).catch(i=>{console.log(i),this.isLogin=!1;let c="Could not sign you in, please try again.";"auth/user-not-found"==i.code?c="E-mail address could not be found":"auth/wrong-password"==i.code&&(c="Please enter a correct password"),this.showAlert(c)})}forgotPass(){console.log("this.forgotPass"),this.openPassModal().then(i=>{})}signUp(){return(0,p.mG)(this,void 0,void 0,function*(){yield this.modalCtrl.dismiss(),this.openRegisterModal()})}closeModal(){return(0,p.mG)(this,void 0,void 0,function*(){this.rute.navigateRoot(["tabs/home/"]),yield this.modalCtrl.dismiss()})}openRegisterModal(){this.routerService.navigate("/login/register")}openPassModal(){return(0,p.mG)(this,void 0,void 0,function*(){return yield(yield this.modalCtrl.create({component:o,cssClass:"modal-large"})).present()})}showAlert(i){return(0,p.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({header:"Alert?",cssClass:"custom-alert",message:i,buttons:["OK"]})).present()})}}return l.\u0275fac=function(i){return new(i||l)(e.Y36(s.IN),e.Y36(s.SH),e.Y36(f.e),e.Y36(v.c),e.Y36(s.Br),e.Y36(r.s))},l.\u0275cmp=e.Xpm({type:l,selectors:[["app-login"]],decls:33,vars:2,consts:[[1,"ion-text-center","toolbar"],["slot","end"],["routerLink","/tabs/home","color","black"],["name","close"],[1,"content"],[1,"modal-content"],["position","floating"],["type","text",3,"ngModel","ngModelChange"],["type","password",3,"ngModel","keyup.enter","ngModelChange"],[1,"login-button","ion-text-center"],["type","submit","enter","",1,"signinButton",3,"keyup.enter","click"],[2,"height","20"],[1,"ion-align-items-center"],["color","danger","size","small","fill","clear",2,"text-align","center !important",3,"click"],[1,"login-q"],["color","success","routerLink","register","size","small"]],template:function(i,c){1&i&&(e.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),e._uU(3," Login"),e.qZA(),e.TgZ(4,"ion-buttons",1)(5,"ion-button",2),e._UZ(6,"ion-icon",3),e.qZA()()()(),e.TgZ(7,"div",4)(8,"ion-content",5)(9,"ion-list")(10,"ion-item")(11,"ion-label",6),e._uU(12,"Email"),e.qZA(),e.TgZ(13,"ion-input",7),e.NdJ("ngModelChange",function(U){return c.email=U}),e.qZA()(),e.TgZ(14,"ion-item")(15,"ion-label",6),e._uU(16,"Password"),e.qZA(),e.TgZ(17,"ion-input",8),e.NdJ("keyup.enter",function(){return c.login()})("ngModelChange",function(U){return c.password=U}),e.qZA()()(),e.TgZ(18,"div",9)(19,"ion-button",10),e.NdJ("keyup.enter",function(){return c.login()})("click",function(){return c.login()}),e._uU(20,"Log in "),e.qZA()(),e._UZ(21,"div",11)(22,"br")(23,"br"),e.TgZ(24,"ion-item",12)(25,"ion-button",13),e.NdJ("click",function(){return c.forgotPass()}),e._uU(26," Forgot password "),e.qZA()(),e._UZ(27,"br"),e.TgZ(28,"ion-row")(29,"ion-label",14),e._uU(30,"Don't have an account?"),e.qZA(),e.TgZ(31,"ion-button",15),e._uU(32," Register "),e.qZA()()()()),2&i&&(e.xp6(13),e.Q6J("ngModel",c.email),e.xp6(4),e.Q6J("ngModel",c.password))},dependencies:[d.JJ,d.On,s.YG,s.Sm,s.W2,s.Gu,s.gu,s.pK,s.Ie,s.Q$,s.q_,s.Nd,s.wd,s.sr,s.j9,s.YI,g.rH],styles:[".login-q[_ngcontent-%COMP%]{margin:10px}modal-wrapper[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%}@media not all and (min-height: 600px) and (min-width: 768px){ion-modal[_ngcontent-%COMP%]   ion-backdrop[_ngcontent-%COMP%]{visibility:hidden}}@media only screen and (min-height: 0px) and (min-width: 0px){.modal-wrapper[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%}}.overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;z-index:1;opacity:.5;background-color:#333}.modal_content[_ngcontent-%COMP%]{display:block;position:relative;top:25%;left:0;right:0;width:100%;height:50%;z-index:1;margin:0 auto;padding:10px;color:#333;background:#e8e8e8;background:linear-gradient(to bottom,#fff 0%,#e8e8e8 100%);border-radius:5px;box-shadow:0 2px 3px rgba(51,51,51,.35);box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box}.circle[_ngcontent-%COMP%]{position:absolute;height:100px;width:100px;border-radius:50%;border:3px solid white;left:50%;margin-left:-55px;top:-40px;background:#d33;z-index:10000}.modal-content[_ngcontent-%COMP%]{padding-top:5rem}.content[_ngcontent-%COMP%]{width:400px;height:800px;margin:auto}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{background:cadetblue}ion-header[_ngcontent-%COMP%]   ion-buttons[_ngcontent-%COMP%]{background:transparent}ion-header[_ngcontent-%COMP%]   ion-buttons[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{background:transparent}ion-header[_ngcontent-%COMP%]   ion-buttons[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{background:transparent}ion-header[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{background-color:gray}"]}),l})()},{path:"register",loadChildren:()=>a.e(6071).then(a.bind(a,6071)).then(l=>l.RegisterPageModule)}];let u=(()=>{class l{}return l.\u0275fac=function(i){return new(i||l)},l.\u0275mod=e.oAB({type:l}),l.\u0275inj=e.cJS({imports:[g.Bz.forChild(n),g.Bz]}),l})(),P=(()=>{class l{}return l.\u0275fac=function(i){return new(i||l)},l.\u0275mod=e.oAB({type:l}),l.\u0275inj=e.cJS({imports:[h.ez,d.u5,s.Pc,u]}),l})()},5146:(b,C,a)=>{a.d(C,{s:()=>v});var h=a(3562),d=a(8179),s=a(4004),g=a(590),p=a(4650),e=a(1085),f=a(5552);let v=(()=>{class y{constructor(o,r,t){this.firestore=o,this.db=r,this.fireDatabase=t,this.feedsCollection=this.db.collection("feeds"),this.usersCollection=this.db.collection("users")}filterFeedData(o){return this.db.collection("feeds",r=>r.where("userType","==",o.charAt(0).toUpperCase()).orderBy("time","desc")).snapshotChanges().pipe((0,s.U)(r=>r.map(t=>(console.log(t),Object.assign({id:t.payload.doc.id},t.payload.doc.data())))))}getDocById(o){const r=this.docRef(o);return(0,d.QT)(r)}getDocsByField(o,r,t){return this.db.collection(o,n=>n.where(r,"==",t))}getUserByEmail(o){return console.log("Provided email",o),this.getDocsByField("users","email",o).snapshotChanges().pipe((0,s.U)(r=>{const t=r[0],n=t.payload.doc.data();return{id:t.payload.doc.id,name:n.name,lastName:n.lastName,username:n.username,email:n.email,userType:n.userType,password:n.password,location:n.location,profilePictureUrl:n.profilePictureUrl,pershkrim:n.pershkrim}}),(0,g.P)())}docRef(o){return(0,h.JU)(this.firestore,o)}collectionRef(o){return(0,d.hJ)(this.firestore,o)}setDocument(o,r){const t=this.docRef(o);return(0,h.pl)(t,r)}addDocument(o,r){const t=this.collectionRef(o);return(0,d.ET)(t,r)}getDocs(o,r){let t=this.collectionRef(o);return r&&(t=(0,d.IO)(t,r)),(0,d.PL)(t)}collectionDataQuery(o,r){let t=this.collectionRef(o);return r&&(t=(0,d.IO)(t,r)),(0,h.BS)(t,{idField:"id"})}docDataQuery(o,r,t){let u,n=this.docRef(o);return t&&(n=(0,d.IO)(n,t)),u=r?(0,h._1)(n,{idField:"id"}):(0,h._1)(n),u}orderByQuery(o,r="asc"){return(0,d.Xo)(o,r)}addFeed(o){return this.feedsCollection.doc(o.id).set(o).then(()=>{console.log("Feed updated successfully!")}).catch(r=>{console.error(r)})}updateFeedFieldById(o,r){return this.feedsCollection.doc(o).update(r).then(()=>{console.log("Feed updated successfully!")}).catch(t=>{console.error(t)})}deleteFeed(o){return this.feedsCollection.doc(o).delete().then(()=>{console.log("Feed deleted successfully!")}).catch(r=>{console.error(r)})}getFeed(o){return this.feedsCollection.doc(o).get()}updateUser(o,r){return this.usersCollection.doc(o).update(r).then(()=>{console.log("User updated successfully!")}).catch(t=>{console.error(t)})}deleteUserData(o){return this.usersCollection.doc(o).delete().then(()=>{console.log("User deleted successfully!")}).catch(r=>{console.error(r)})}getUser(o){return this.usersCollection.doc(o).get()}deleteUserFeeds(o){return this.filterFeedData(o.userType).subscribe(r=>{r.forEach(t=>{t.userName==o.username&&this.deleteFeed(t.id).then(n=>{}).catch(n=>{throw n})})})}}return y.\u0275fac=function(o){return new(o||y)(p.LFG(h.gg),p.LFG(e.ST),p.LFG(f.KQ))},y.\u0275prov=p.Yz7({token:y,factory:y.\u0275fac,providedIn:"root"}),y})()},1228:(b,C,a)=>{a.d(C,{e:()=>M});var h=a(655),d=a(4322),s=a(1135),g=a(4650),p=a(9376),e=a(7323),f=a(1205),v=a(5146),y=a(603);let M=(()=>{class o{constructor(t,n,u,P,l){this.routerService=t,this.auth=n,this.afAuth=u,this.apiService=P,this.alertController=l,this._uid=new s.X(null),this.userType="U",this.currentUserId="",1==this.isLogin&&this.getCurrentUser().subscribe(m=>{this.userType=m.data().userType.charAt(0).toUpperCase(),console.log(this.userType,"=usertype")}),this.checkAuth().then(m=>{this.isLogin=!0,this.getCurrentUser().subscribe(i=>{this.userType=i.data().userType.charAt(0).toUpperCase(),console.log(this.userType,"=usertype")})}).catch(m=>{this.isLogin=!1})}getCurrentUser(){return this.getUserId(),console.log(this.currentUserId,"id on authService",this.auth.currentUser.uid),this.apiService.getUser(this.auth.currentUser.uid)}getUserId(){return this.afAuth.authState.subscribe(t=>{t&&(console.log(t.uid),this.currentUserId=t.uid)}),this.currentUserId}login(t,n){return(0,h.mG)(this,void 0,void 0,function*(){try{const u=(0,d.e5)(this.auth,t,n);console.log(u),(yield u).user&&(this.setUserData((yield u).user.uid),this.isLogin=!0,this.correctUser=yield this.getUserData(this._uid),this.getCurrentUser().subscribe(P=>{this.userType=P.data().userType.charAt(0).toUpperCase(),console.log(this.userType,"=usertype"),sessionStorage.setItem("userName",P.data().username),sessionStorage.setItem("userType",this.userType),this.currentUserId=P.data().id}))}catch(u){throw this.isLogin=!1,u}})}getId(){var t;const n=(0,d.v0)();return this.correctUser=n.currentUser,console.log(this.correctUser),null===(t=this.correctUser)||void 0===t?void 0:t.uid}setUserData(t){this._uid.next(t)}randomIntFromInterval(t,n){return Math.floor(Math.random()*(n-t+1)+t)}register(t){return(0,h.mG)(this,void 0,void 0,function*(){try{const n=yield(0,d.Xb)(this.auth,t.email,t.password);console.log("perdoruesi i regjistruar : ",n);const u={id:n.user.uid,name:t.name.charAt(0).toUpperCase()+t.name.slice(1),lastName:t.lastName.charAt(0).toUpperCase()+t.lastName.slice(1),username:t.username.charAt(0).toUpperCase()+t.username.slice(1),email:t.email,userType:t.userType.charAt(0).toUpperCase()+t.userType.slice(1),profilePictureUrl:"https://i.avatar/"+this.randomIntFromInterval(200,400)};yield this.apiService.setDocument("users/".concat(n.user.uid),u)}catch(n){throw n}})}resetUserPassword(t){return(0,h.mG)(this,void 0,void 0,function*(){try{yield(0,d.LS)(this.auth,t).catch(n=>{throw n})}catch(n){throw n}})}logout(){return(0,h.mG)(this,void 0,void 0,function*(){return yield this.auth.signOut().then(t=>{this.isLogin=!1,this.userType="U",this._uid.next(null)}).catch(t=>{throw t}),!0})}checkAuth(){return new Promise((t,n)=>{(0,d.Aj)(this.auth,u=>{t(u)})})}getUserData(t){return(0,h.mG)(this,void 0,void 0,function*(){yield(yield this.apiService.getDocById("users/$(id)")).data()})}deleteAccount(t){return this.auth.currentUser.delete().then(n=>{console.log(t,"Deleted"),this.deleteUserData(t),this.logout().then(u=>{this.routerService.navigate("/login").then(P=>{})})}).catch(n=>{this.showAlert(n.code).then(u=>{})})}showAlert(t){return(0,h.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({header:"Alert?",cssClass:"custom-alert",message:t,buttons:["OK"]})).present()})}deleteUserData(t){this.apiService.deleteUserData(t.id).then(n=>{this.isLogin=!1,this.userType="U",this._uid.next(null),this.correctUser=null,this.apiService.deleteUserFeeds(t)})}changePass(t){return this.afAuth.currentUser.then(n=>{n.updatePassword(t).then(()=>{console.log("Password changed successfully")}).catch(u=>{console.error("Error changing password:",u)})})}}return o.\u0275fac=function(t){return new(t||o)(g.LFG(p.c),g.LFG(e.gx),g.LFG(f.zQ),g.LFG(v.s),g.LFG(y.Br))},o.\u0275prov=g.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})()},9376:(b,C,a)=>{a.d(C,{c:()=>s});var h=a(9062),d=a(4650);let s=(()=>{class g{constructor(e){this.router=e}navigate(e){return this.router.events.subscribe(f=>{f instanceof h.wM&&"administration"===f.snapshot.outlet&&this.outlet.deactivate()}),this.router.navigateByUrl(e,{replaceUrl:!0}).then(f=>{}).catch(f=>{})}navigateWithData(e,f){return this.router.events.subscribe(v=>{v instanceof h.wM&&"administration"===v.snapshot.outlet&&this.outlet.deactivate()}),this.router.navigate(e,f).then(v=>{}).catch(v=>{})}}return g.\u0275fac=function(e){return new(e||g)(d.LFG(h.F0))},g.\u0275prov=d.Yz7({token:g,factory:g.\u0275fac,providedIn:"root"}),g})()}}]);