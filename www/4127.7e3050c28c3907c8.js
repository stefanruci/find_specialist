"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4127],{4127:(I,U,i)=>{i.r(U),i.d(U,{MessagesPageModule:()=>P});var h=i(6895),g=i(433),u=i(603),v=i(9062),_=i(5806),f=i(5861),y=i(5698),e=i(4650),A=i(9376),o=i(4004),a=i(1228),t=i(5146);class s{constructor(n,r){this.auth=n,this.api=r,this.getId()}getId(){console.log(this.currentUserId),this.currentUserId=this.auth.getId()}createChatRoom(n){var r=this;return(0,f.Z)(function*(){try{var d;let p;if(console.log("exist docs: ",p),(null===(d=p)||void 0===d?void 0:d.length)>0)return p[0];const T={members:[r.currentUserId,n],type:"private",createdAt:new Date,updatedAt:new Date};return p=yield r.api.addDocument("chatRooms",T),p}catch(p){throw p}})()}getChatRoomMessages(n){this.selectedChatRoomMessages=this.api.collectionDataQuery(`chats/${n}/messages`,this.api.orderByQuery("createdAt","desc")).pipe((0,o.U)(r=>r.reverse()))}sendMessage(n,r){var d=this;return(0,f.Z)(function*(){try{const p={message:r,sender:d.currentUserId,createdAt:new Date};console.log(n),n&&(yield d.api.addDocument(`chats/${n}/messages`,p))}catch(p){throw p}})()}}function c(l,n){if(1&l&&(e.TgZ(0,"ion-text")(1,"p"),e._uU(2),e.qZA()()),2&l){const r=e.oxw();e.xp6(2),e.Oqu(r.model.subTitle)}}s.\u0275fac=function(n){return new(n||s)(e.LFG(a.e),e.LFG(t.s))},s.\u0275prov=e.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"});class m{constructor(){}ngOnInit(){}}m.\u0275fac=function(n){return new(n||m)},m.\u0275cmp=e.Xpm({type:m,selectors:[["app-empty-screen"]],inputs:{model:"model"},decls:9,vars:4,consts:[[1,"ion-text-center"],[3,"name","color"],[4,"ngIf"]],template:function(n,r){1&n&&(e.TgZ(0,"ion-grid")(1,"ion-row")(2,"ion-col",0),e._UZ(3,"ion-icon",1),e.qZA()(),e.TgZ(4,"ion-row")(5,"ion-col",0)(6,"ion-label"),e._uU(7),e.qZA(),e.YNc(8,c,3,1,"ion-text",2),e.qZA()()()),2&n&&(e.xp6(3),e.Q6J("name",null==r.model?null:r.model.icon)("color",null==r.model?null:r.model.color),e.xp6(4),e.hij(" ",null==r.model?null:r.model.title," "),e.xp6(1),e.Q6J("ngIf",null==r.model?null:r.model.subTitle))},dependencies:[h.O5,u.wI,u.jY,u.gu,u.Q$,u.Nd,u.yW],styles:["ion-grid[_ngcontent-%COMP%]{transform:translateY(10vh)}ion-grid[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18rem}"]});const C=["popover"];function D(l,n){if(1&l){const r=e.EpF();e.TgZ(0,"ion-content",13),e.NdJ("click",function(){e.CHM(r);const p=e.oxw();return e.KtG(p.logout())}),e.TgZ(1,"ion-label",14),e._uU(2," LOGOUT"),e.qZA()()}}function O(l,n){if(1&l&&e._UZ(0,"app-empty-screen",18),2&l){const r=e.oxw(2);e.Q6J("model",r.model)}}function R(l,n){if(1&l&&(e.ynx(0),e.TgZ(1,"ion-avatar",22),e._UZ(2,"img",23),e.qZA(),e.TgZ(3,"ion-label"),e._uU(4),e.qZA(),e.BQk()),2&l){const r=n.ngIf,d=e.oxw(5);let p,T;e.xp6(2),e.Q6J("src",null==(p=d.getUser(r))?null:p.photo,e.LSH),e.xp6(2),e.hij(" ",null==(T=d.getUser(r))?null:T.name," ")}}function Z(l,n){if(1&l){const r=e.EpF();e.TgZ(0,"ion-item",21),e.NdJ("click",function(){const T=e.CHM(r).$implicit,b=e.oxw(4);return e.KtG(b.getChat(T))}),e.YNc(1,R,5,2,"ng-container",17),e.ALo(2,"async"),e.qZA()}if(2&l){const r=n.$implicit;e.Q6J("detail",!0),e.xp6(1),e.Q6J("ngIf",e.lcZ(2,2,null==r?null:r.user))}}function L(l,n){if(1&l&&(e.TgZ(0,"ion-list")(1,"ion-list-header",19),e._uU(2," RECENT CHATS "),e.qZA(),e.YNc(3,Z,3,4,"ion-item",20),e.qZA()),2&l){const r=e.oxw().ngIf;e.xp6(3),e.Q6J("ngForOf",r)}}function S(l,n){if(1&l&&(e.ynx(0),e.YNc(1,L,4,1,"ion-list",17),e.BQk()),2&l){const r=n.ngIf;e.xp6(1),e.Q6J("ngIf",(null==r?null:r.length)>0)}}function x(l,n){if(1&l&&(e.TgZ(0,"ion-content",15),e.YNc(1,O,1,1,"app-empty-screen",16),e.ALo(2,"async"),e.YNc(3,S,2,1,"ng-container",17),e.ALo(4,"async"),e.qZA()),2&l){const r=e.oxw();let d;e.xp6(1),e.Q6J("ngIf",0===(null==(d=e.lcZ(2,2,r.chatRooms))?null:d.length)),e.xp6(2),e.Q6J("ngIf","chats"===r.segment&&e.lcZ(4,4,r.chatRooms))}}class E{constructor(n,r,d){this.routerService=n,this.chatService=r,this.modalCtrl=d,this.isCollapsed=!0,this.segment="chats",this.open_new_chat=!1,this.model={icon:"chatbubbles-outline",title:"No Chat Rooms",color:"danger"},this.isLogin=!1}ngOnInit(){this.getRooms(),this.isLogin=this.chatService.auth.isLogin}openLoginModal(){return this.routerService.navigate("/login")}getRooms(){this.chatRooms=this.chatService.chatRooms,console.log("chatrooms: ",this.chatRooms)}logout(){var n=this;return(0,f.Z)(function*(){try{console.log("logout"),n.popover.dismiss(),yield n.chatService.auth.logout().then(r=>{n.routerService.navigate("/login")})}catch(r){console.log(r)}})()}onSegmentChanged(n){console.log(n),this.segment=n.detail.value}newChat(){this.open_new_chat=!0,this.users||this.getUsers()}getUsers(){this.users=this.chatService.users}onWillDismiss(n){}getChat(n){(null==n?void 0:n.user).pipe((0,y.q)(1)).subscribe(r=>{console.log("data: ",r),this.routerService.navigateWithData(["/","landing-page","chats",null==n?void 0:n.id],{queryParams:{name:null==r?void 0:r.name}})})}getUser(n){return n}}E.\u0275fac=function(n){return new(n||E)(e.Y36(A.c),e.Y36(s),e.Y36(u.IN))},E.\u0275cmp=e.Xpm({type:E,selectors:[["app-messages"]],viewQuery:function(n,r){if(1&n&&e.Gf(C,5),2&n){let d;e.iGM(d=e.CRH())&&(r.popover=d.first)}},decls:20,vars:2,consts:[[1,"header","d-flex"],["expand","full",1,"toolbar","d-flex","justify-content-between"],["name","mail-outline","slot","start",1,"p-0","m-0"],[1,"w-75","ion-padding-top"],[1,""],["fill","clear","id","popover"],["name","log-out-outline","size","small"],["trigger","popover","triggerAction","click"],["popover",""],["mode","md",1,"segment-wrapper",3,"value","ionChange"],["value","chats"],["value","contacts"],["color","light",4,"ngIf"],[1,"ion-padding","ion-text-center",3,"click"],["color","danger"],["color","light"],[3,"model",4,"ngIf"],[4,"ngIf"],[3,"model"],["color","light",1,"ion-padding-bottom"],[3,"detail","click",4,"ngFor","ngForOf"],[3,"detail","click"],["slot","start"],[3,"src"]],template:function(n,r){1&n&&(e.TgZ(0,"div",0)(1,"ion-header")(2,"div",1),e._UZ(3,"ion-icon",2),e.TgZ(4,"h3",3),e._uU(5," Mesazhet"),e.qZA(),e.TgZ(6,"ion-buttons",4)(7,"ion-button",5),e._UZ(8,"ion-icon",6),e.qZA()(),e.TgZ(9,"ion-popover",7,8),e.YNc(11,D,3,0,"ng-template"),e.qZA()(),e.TgZ(12,"ion-segment",9),e.NdJ("ionChange",function(p){return r.onSegmentChanged(p)}),e.TgZ(13,"ion-segment-button",10)(14,"ion-label"),e._uU(15,"Chats"),e.qZA()(),e.TgZ(16,"ion-segment-button",11)(17,"ion-label"),e._uU(18,"Contacts"),e.qZA()()()()(),e.YNc(19,x,5,6,"ion-content",12)),2&n&&(e.xp6(12),e.Q6J("value",r.segment),e.xp6(7),e.Q6J("ngIf",!0===r.isLogin))},dependencies:[h.sg,h.O5,u.BJ,u.YG,u.Sm,u.W2,u.Gu,u.gu,u.Ie,u.Q$,u.q_,u.yh,u.cJ,u.GO,u.d8,u.QI,m,h.Ov],styles:[".toolbar[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{width:100%;height:55.3px;background-color:#226ef2!important;color:#fff}.toolbar[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{height:55.3px}.toolbar[_ngcontent-%COMP%] > h3[_ngcontent-%COMP%]{height:55.3px}.toolbar[_ngcontent-%COMP%] > ion-button[_ngcontent-%COMP%]{height:55.3px}ion-header[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{width:100%;background-color:#226ef2!important;color:#fff}"]});const F=[{path:"",canActivate:[_.a],component:E},{path:"message",loadChildren:()=>i.e(6948).then(i.bind(i,6948)).then(l=>l.MessagePageModule)}];class M{}M.\u0275fac=function(n){return new(n||M)},M.\u0275mod=e.oAB({type:M}),M.\u0275inj=e.cJS({imports:[v.Bz.forChild(F),v.Bz]});var B=i(4197),Q=i(4610);class P{}P.\u0275fac=function(n){return new(n||P)},P.\u0275mod=e.oAB({type:P}),P.\u0275inj=e.cJS({imports:[h.ez,g.u5,u.Pc,M,B.lQ,Q.lK]})},5146:(I,U,i)=>{i.d(U,{s:()=>e});var h=i(3562),g=i(8179),u=i(4004),v=i(590),_=i(4650),f=i(1085),y=i(5552);class e{constructor(o,a,t){this.firestore=o,this.db=a,this.fireDatabase=t,this.feedsCollection=this.db.collection("feeds"),this.usersCollection=this.db.collection("users")}filterFeedData(o){return this.db.collection("feeds",a=>a.where("userType","==",o.charAt(0).toUpperCase()).orderBy("time","desc")).snapshotChanges().pipe((0,u.U)(a=>a.map(t=>(console.log(t),{id:t.payload.doc.id,...t.payload.doc.data()}))))}getDocById(o){const a=this.docRef(o);return(0,g.QT)(a)}getDocsByField(o,a,t){return this.db.collection(o,s=>s.where(a,"==",t))}filterUserByField(o,a){return this.db.collection("users",s=>s.where(o,"==",a)).valueChanges()}getUserByEmail(o){return console.log("Provided email",o),this.getDocsByField("users","email",o).snapshotChanges().pipe((0,u.U)(a=>{const t=a[0],s=t.payload.doc.data();return{id:t.payload.doc.id,name:s.name,lastName:s.lastName,username:s.username,email:s.email,userType:s.userType,password:s.password,location:s.location,profilePictureUrl:s.profilePictureUrl,pershkrim:s.pershkrim}}),(0,v.P)())}docRef(o){return(0,h.JU)(this.firestore,o)}collectionRef(o){return(0,g.hJ)(this.firestore,o)}setDocument(o,a){const t=this.docRef(o);return(0,h.pl)(t,a)}addDocument(o,a){const t=this.collectionRef(o);return(0,g.ET)(t,a)}getDocs(o,a){let t=this.collectionRef(o);return a&&(t=(0,g.IO)(t,a)),(0,g.PL)(t)}collectionDataQuery(o,a){let t=this.collectionRef(o);return a&&(t=(0,g.IO)(t,a)),(0,h.BS)(t,{idField:"id"})}docDataQuery(o,a,t){let c,s=this.docRef(o);return t&&(s=(0,g.IO)(s,t)),c=a?(0,h._1)(s,{idField:"id"}):(0,h._1)(s),c}orderByQuery(o,a="asc"){return(0,g.Xo)(o,a)}addFeed(o){g.EK.now();const t={id:o.id,kompania:o.kompania,pershkrim:o.pershkrim,tel:o.tel,time:o.time,tittle:o.tittle,userName:o.userName,userType:o.userType,vendodhja:o.vendodhja,whatsApp:o.whatsApp};return console.log(o,"add Feed method"),this.feedsCollection.doc(o.id).set(t).then(()=>{console.log("Feed updated successfully!")}).catch(s=>{console.error(s)})}updateFeedFieldById(o,a){return this.feedsCollection.doc(o).update(a).then(()=>{console.log("Feed updated successfully!")}).catch(t=>{console.error(t)})}deleteFeed(o){return this.feedsCollection.doc(o).delete().then(()=>{console.log("Feed deleted successfully!")}).catch(a=>{console.error(a)})}getFeed(o){return this.feedsCollection.doc(o).get()}updateUser(o,a){return this.usersCollection.doc(o).update(a).then(()=>{console.log("User updated successfully!")}).catch(t=>{console.error(t)})}deleteUserData(o){return this.usersCollection.doc(o).delete().then(()=>{console.log("User deleted successfully!")}).catch(a=>{console.error(a)})}getUser(o){return this.usersCollection.doc(o).get()}deleteUserFeeds(o){return this.filterFeedData(o.userType).subscribe(a=>{a.forEach(t=>{t.userName==o.username&&this.deleteFeed(t.id).then(s=>{}).catch(s=>{throw s})})})}}e.\u0275fac=function(o){return new(o||e)(_.LFG(h.gg),_.LFG(f.ST),_.LFG(y.KQ))},e.\u0275prov=_.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"})},1228:(I,U,i)=>{i.d(U,{e:()=>o});var h=i(5861),g=i(4322),u=i(1135),v=i(4650),_=i(9376),f=i(7323),y=i(1205),e=i(5146),A=i(603);class o{constructor(t,s,c,m,C){this.routerService=t,this.auth=s,this.afAuth=c,this.apiService=m,this.alertController=C,this._uid=new u.X(null),this.userType="U",this.currentUserId="",this.isLogin=!1,1==this.isLogin&&this.getCurrentUser().subscribe(D=>{this.userType=D.data().userType.charAt(0).toUpperCase(),console.log(this.userType,"=usertype")}),this.checkAuth().then(D=>{this.isLogin=!0,this.getCurrentUser().subscribe(O=>{this.userType=O.data().userType.charAt(0).toUpperCase(),console.log(this.userType,"=usertype")})}).catch(D=>{this.isLogin=!1})}getCurrentUser(){if(this.getUserId(),this.auth.currentUser.uid.length>0)return console.log(this.currentUserId,"id on authService",this.auth.currentUser.uid),this.apiService.getUser(this.auth.currentUser.uid)}getUserId(){return this.afAuth.authState.subscribe(t=>{t&&(console.log(t.uid,"aush"),this.currentUserId=t.uid)}),setTimeout(()=>{},2500),this.currentUserId}getAuthState(){return this.afAuth}login(t,s){var c=this;return(0,h.Z)(function*(){try{const m=(0,g.e5)(c.auth,t,s);console.log(m),(yield m).user&&(c.setUserData((yield m).user.uid),c.isLogin=!0,c.correctUser=yield c.getUserData(c._uid),c.getCurrentUser().subscribe(C=>{c.userType=C.data().userType.charAt(0).toUpperCase(),console.log(c.userType,"=usertype"),sessionStorage.setItem("userName",C.data().username),sessionStorage.setItem("userType",c.userType),c.currentUserId=C.data().id}))}catch(m){throw c.isLogin=!1,m}})()}getId(){var t;const s=(0,g.v0)();return this.correctUser=s.currentUser,console.log(this.correctUser),null===(t=this.correctUser)||void 0===t?void 0:t.uid}setUserData(t){this._uid.next(t)}randomIntFromInterval(t,s){return Math.floor(Math.random()*(s-t+1)+t)}register(t){var s=this;return(0,h.Z)(function*(){try{const c=yield(0,g.Xb)(s.auth,t.email,t.password);console.log("perdoruesi i regjistruar : ",c);const m={id:c.user.uid,name:t.name.charAt(0).toUpperCase()+t.name.slice(1),lastName:t.lastName.charAt(0).toUpperCase()+t.lastName.slice(1),username:t.username.charAt(0).toUpperCase()+t.username.slice(1),email:t.email,userType:t.userType.charAt(0).toUpperCase()+t.userType.slice(1),profilePictureUrl:"https://i.avatar/"+s.randomIntFromInterval(200,400)};yield s.apiService.setDocument("users/".concat(c.user.uid),m)}catch(c){throw c}})()}resetUserPassword(t){var s=this;return(0,h.Z)(function*(){try{yield(0,g.LS)(s.auth,t).catch(c=>{throw c})}catch(c){throw c}})()}logout(){var t=this;return(0,h.Z)(function*(){return yield t.auth.signOut().then(s=>{t.isLogin=!1,t.userType="U",t._uid.next(null)}).catch(s=>{throw s}),!0})()}checkAuth(){return new Promise((t,s)=>{(0,g.Aj)(this.auth,c=>{t(c)})})}getUserData(t){var s=this;return(0,h.Z)(function*(){yield(yield s.apiService.getDocById("users/$(id)")).data()})()}deleteAccount(t){return this.auth.currentUser.delete().then(s=>{console.log(t,"Deleted"),this.deleteUserData(t),this.logout().then(c=>{this.routerService.navigate("/login").then(m=>{})})}).catch(s=>{this.showAlert(s.code).then(c=>{})})}showAlert(t){var s=this;return(0,h.Z)(function*(){yield(yield s.alertController.create({header:"Alert?",cssClass:"custom-alert",message:t,buttons:["OK"]})).present()})()}deleteUserData(t){this.apiService.deleteUserData(t.id).then(s=>{this.isLogin=!1,this.userType="U",this._uid.next(null),this.correctUser=null,this.apiService.deleteUserFeeds(t)})}changePass(t){return this.afAuth.currentUser.then(s=>{s.updatePassword(t).then(()=>{console.log("Password changed successfully")}).catch(c=>{console.error("Error changing password:",c)})})}}o.\u0275fac=function(t){return new(t||o)(v.LFG(_.c),v.LFG(f.gx),v.LFG(y.zQ),v.LFG(e.s),v.LFG(A.Br))},o.\u0275prov=v.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"})},9376:(I,U,i)=>{i.d(U,{c:()=>u});var h=i(9062),g=i(4650);class u{constructor(_){this.router=_}navigate(_){return this.router.events.subscribe(f=>{f instanceof h.wM&&"administration"===f.snapshot.outlet&&this.outlet.deactivate()}),this.router.navigateByUrl(_,{replaceUrl:!0}).then(f=>{}).catch(f=>{})}navigateWithData(_,f){return this.router.events.subscribe(y=>{y instanceof h.wM&&"administration"===y.snapshot.outlet&&this.outlet.deactivate()}),this.router.navigate(_,f).then(y=>{}).catch(y=>{})}}u.\u0275fac=function(_){return new(_||u)(g.LFG(h.F0))},u.\u0275prov=g.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"})}}]);